{% extends "livros/base.html" %}
{% block title %}Biblioteca - Home{% endblock %}
{% block content %}
<h1>Catálogo de Livros</h1>

<!-- Barra de Pesquisa -->
<form method="get">
  <input type="text" name="search" placeholder="Buscar..." value="{{ query }}">
  <button type="submit" class="button-neumorphic">Buscar</button>
</form>

<!-- Filtro por Tags -->
<p>Filtrar por tag:</p>
{% for tag in tags %}
  <a href="?tag={{ tag.name }}" class="tag-link">{{ tag.name }}</a>
{% endfor %}

<!-- Lista de Unidades Disponíveis -->
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Título do Livro</th>
      <th>Código da Unidade</th>
      <th>Tags</th>
      <th>Status</th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
    {% for unit in units %}
    <tr>
      <td>{{ unit.book.title }}</td>
      <td>{{ unit.code }}</td>
      <td>
        {% for tag in unit.book.tags.all %}
          <span class="badge">{{ tag.name }}</span>
        {% endfor %}
      </td>
      <td>
        {% if unit.available %}
          Disponível
        {% else %}
          Emprestado
        {% endif %}
      </td>
      <td>
        {% if user.is_staff and unit.available %}
          <a href="{% url 'borrow_book' unit.id %}" class="btn btn-primary">Emprestar</a>
        {% endif %}
        {% if user.is_staff %}
          <a href="{% url 'edit_book' unit.book.id %}" class="btn btn-warning">Editar Livro</a>
        {% endif %}
      </td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" class="text-center">Nenhuma unidade disponível.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}